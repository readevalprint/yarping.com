<script src="jquery.js"></script>
<script src="typed.js"></script>
<script src="pouchdb-4.0.0.js"></script>
<meta charset="utf-8">
<meta name="apple-mobile-web-app-capable" content="yes" />
<meta name="apple-mobile-web-app-status-bar-style" content="black">
<meta name="format-detection" content="telephone=no">
<meta name = "viewport" content = "width=320, initial-scale=1.0, user-scalable = no">
<title>Yarping</title>

<style>
html, body {
  margin: 0;
  padding: 0;
}

body {
  margin: 5%;
}

* {
    font-family: "HelveticaNeue-Light", "Helvetica Neue Light", "Helvetica Neue", Helvetica, Arial, "Lucida Grande", sans-serif; 
    font-weight: 300;
    font-size: 22pt;
}

p {
    margin-left: auto;
    margin-right: auto;
    line-height: 1.5em;
}

button {
    width: 100%;
    color: black;
    background-color: white;
    border: 1px solid lightgray;
    margin-top: 2em;
    cursor: pointer;
}

.link {
  text-align: center;
}

a {
  color: black;
  border-bottom: 1px solid black;
  text-decoration: none;
}

#outer {
    display: table; height: 100%; #position: relative; overflow: hidden; max-width: 10cm; margin-left: auto; margin-right: auto; }

#middle {
 #position: absolute; #top: 50%;display: table-cell; vertical-align: middle;
}

#inner {
 #position: relative; #top: -50%;
 width: 380px;
}

#outer {
-webkit-transition: opacity 0.24s ease-in-out;
   -moz-transition: opacity 0.24s ease-in-out;
        transition: opacity 0.24s ease-in-out;
}

.wf-loading #outer {
  opacity: 0;
}

.wf-active #outer {
  opacity: 1;
}

</style>

<div id="outer"><div id="middle"><div id="inner"></div></div></div> 

<script>
PouchDB.debug.enable('*');

$("#inner").typed({
  strings: ["<p> Welcome. <p>Contacting headquarters for instructions ... "],
  typeSpeed: 0,
  showCursor: false,
});

/*
$("#inner").typed({
  showCursor: false,
  strings: [document.getElementById(page).innerHTML],
  typeSpeed: 0
});
*/

var mission1 = 

$(document.body).on("click.button", function(event) {
   var next_page = ($(event.target).attr('href') || "").replace("#", "");
   eval(next_page);
})

var localDB = new PouchDB('localgames');
var remoteDB = new PouchDB('https://yarping.iriscouch.com/season1/');

localDB.sync(remoteDB, {
  live: true,
  retry: true,
}).on('change', function (change) {
  console.log('something changed!', change);
  do_missions();
}).on('paused', function (info) {
  console.log('info!', info);
}).on('active', function (info) {
  console.log('active', info);
  do_missions();
}).on('error', function (err) {
  console.exception(err);
  alert('There was an error communicating with headquarters.')
});

function do_missions() {

  localDB.query(function (doc, emit) {
    if (doc.type === "mission") {
      emit(doc._id);
    }
  }, {
    include_docs : true,
    for_user: '007',
  }).then(function (result) {
    if (result.total_rows == 0) {
      console.log('Did not find any missions', result)
      localDB.post({
        'type': 'mission',
        'user': '007',
        'html': "<p>Connection established. <p>Are you ready for your first mission ? <br><button class=next href='#create_first_mission'>Yes, ready.</button>"
      });
    } else {
      console.log('FOUND A MISSION', result);
    }
  }).catch(function (err) {
    alert('error');
  });

};

</script>

